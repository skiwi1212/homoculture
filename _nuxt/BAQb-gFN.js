import{d as j,u as G,c as V}from"./D2G85vdH.js";import{r as E,L as T,aj as z,d as F,aH as H,aI as Y,a8 as C,a3 as q,ax as J,K as Q,H as O,j as B,w as h,g as P,J as c,M as _,b as W,c as X,a4 as Z}from"./B0V24EwP.js";import{S as R,P as N}from"./BIi6r2t3.js";import{u as ee}from"./cWDgdZQ2.js";import{u as te}from"./D36rqGaW.js";function M(){let e=document.activeElement;if(e==null)return null;for(;e!=null&&e.shadowRoot!=null&&e.shadowRoot.activeElement!=null;)e=e.shadowRoot.activeElement;return e}function x(){const e=E(),s=T(()=>{var o,a;return["#text","#comment"].includes((o=e.value)==null?void 0:o.$el.nodeName)?(a=e.value)==null?void 0:a.$el.nextElementSibling:j(e)});return{primitiveElement:e,currentElement:s}}const oe="rovingFocusGroup.onEntryFocus",ne={bubbles:!1,cancelable:!0},ae={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function re(e,s){return s!=="rtl"?e:e==="ArrowLeft"?"ArrowRight":e==="ArrowRight"?"ArrowLeft":e}function se(e,s,o){const a=re(e.key,o);if(!(s==="vertical"&&["ArrowLeft","ArrowRight"].includes(a))&&!(s==="horizontal"&&["ArrowUp","ArrowDown"].includes(a)))return ae[a]}function D(e,s=!1){const o=M();for(const a of e)if(a===o||(a.focus({preventScroll:s}),M()!==o))return}function le(e,s){return e.map((o,a)=>e[(s+a)%e.length])}const K="data-reka-collection-item";function $(e={}){const{key:s="",isProvider:o=!1}=e,a=`${s}CollectionProvider`;let l;if(o){const r=E(new Map);l={collectionRef:E(),itemMap:r},J(a,l)}else l=z(a);const g=(r=!1)=>{const n=l.collectionRef.value;if(!n)return[];const i=Array.from(n.querySelectorAll(`[${K}]`)),f=Array.from(l.itemMap.value.values()).sort((m,I)=>i.indexOf(m.ref)-i.indexOf(I.ref));return r?f:f.filter(m=>m.ref.dataset.disabled!=="")},v=F({name:"CollectionSlot",setup(r,{slots:n}){const{primitiveElement:i,currentElement:d}=x();return q(d,()=>{l.collectionRef.value=d.value}),()=>C(R,{ref:i},n)}}),y=F({name:"CollectionItem",inheritAttrs:!1,props:{value:{validator:()=>!0}},setup(r,{slots:n,attrs:i}){const{primitiveElement:d,currentElement:f}=x();return H(m=>{if(f.value){const I=Y(f.value);l.itemMap.value.set(I,{ref:f.value,value:r.value}),m(()=>l.itemMap.value.delete(I))}}),()=>C(R,{...i,[K]:"",ref:d},n)}}),b=T(()=>Array.from(l.itemMap.value.values())),t=T(()=>l.itemMap.value.size);return{getItems:g,reactiveItems:b,itemMapSize:t,CollectionSlot:v,CollectionItem:y}}const[ie,ue]=V("RovingFocusGroup"),ve=F({__name:"RovingFocusGroup",props:{orientation:{default:void 0},dir:{},loop:{type:Boolean,default:!1},currentTabStopId:{},defaultCurrentTabStopId:{},preventScrollOnEntryFocus:{type:Boolean,default:!1},asChild:{type:Boolean},as:{}},emits:["entryFocus","update:currentTabStopId"],setup(e,{expose:s,emit:o}){const a=e,l=o,{loop:g,orientation:v,dir:y}=Q(a),b=ee(y),t=G(a,"currentTabStopId",l,{defaultValue:a.defaultCurrentTabStopId,passive:a.currentTabStopId===void 0}),r=E(!1),n=E(!1),i=E(0),{getItems:d,CollectionSlot:f}=$({isProvider:!0});function m(u){const w=!n.value;if(u.currentTarget&&u.target===u.currentTarget&&w&&!r.value){const S=new CustomEvent(oe,ne);if(u.currentTarget.dispatchEvent(S),l("entryFocus",S),!S.defaultPrevented){const A=d().map(p=>p.ref).filter(p=>p.dataset.disabled!==""),k=A.find(p=>p.getAttribute("data-active")==="true"),U=A.find(p=>p.id===t.value),L=[k,U,...A].filter(Boolean);D(L,a.preventScrollOnEntryFocus)}}n.value=!1}function I(){setTimeout(()=>{n.value=!1},1)}return s({getItems:d}),ue({loop:g,dir:b,orientation:v,currentTabStopId:t,onItemFocus:u=>{t.value=u},onItemShiftTab:()=>{r.value=!0},onFocusableItemAdd:()=>{i.value++},onFocusableItemRemove:()=>{i.value--}}),(u,w)=>(B(),O(c(f),null,{default:h(()=>[P(c(N),{tabindex:r.value||i.value===0?-1:0,"data-orientation":c(v),as:u.as,"as-child":u.asChild,dir:c(b),style:{outline:"none"},onMousedown:w[0]||(w[0]=S=>n.value=!0),onMouseup:I,onFocus:m,onBlur:w[1]||(w[1]=S=>r.value=!1)},{default:h(()=>[_(u.$slots,"default")]),_:3},8,["tabindex","data-orientation","as","as-child","dir"])]),_:3}))}}),be=F({__name:"RovingFocusItem",props:{tabStopId:{},focusable:{type:Boolean,default:!0},active:{type:Boolean,default:!0},allowShiftKey:{type:Boolean},asChild:{type:Boolean},as:{default:"span"}},setup(e){const s=e,o=ie(),a=te(),l=T(()=>s.tabStopId||a),g=T(()=>o.currentTabStopId.value===l.value),{getItems:v,CollectionItem:y}=$();W(()=>{s.focusable&&o.onFocusableItemAdd()}),X(()=>{s.focusable&&o.onFocusableItemRemove()});function b(t){if(t.key==="Tab"&&t.shiftKey){o.onItemShiftTab();return}if(t.target!==t.currentTarget)return;const r=se(t,o.orientation.value,o.dir.value);if(r!==void 0){if(t.metaKey||t.ctrlKey||t.altKey||!s.allowShiftKey&&t.shiftKey)return;t.preventDefault();let n=[...v().map(i=>i.ref).filter(i=>i.dataset.disabled!=="")];if(r==="last")n.reverse();else if(r==="prev"||r==="next"){r==="prev"&&n.reverse();const i=n.indexOf(t.currentTarget);n=o.loop.value?le(n,i+1):n.slice(i+1)}Z(()=>D(n))}}return(t,r)=>(B(),O(c(y),null,{default:h(()=>[P(c(N),{tabindex:g.value?0:-1,"data-orientation":c(o).orientation.value,"data-active":t.active,"data-disabled":t.focusable?void 0:"",as:t.as,"as-child":t.asChild,onMousedown:r[0]||(r[0]=n=>{t.focusable?c(o).onItemFocus(l.value):n.preventDefault()}),onFocus:r[1]||(r[1]=n=>c(o).onItemFocus(l.value)),onKeydown:b},{default:h(()=>[_(t.$slots,"default")]),_:3},8,["tabindex","data-orientation","data-active","data-disabled","as","as-child"])]),_:3}))}});export{ae as M,ve as _,be as a,M as g,$ as u};
